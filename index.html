<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StakeMax Demo</title>
<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const SUPABASE_URL = 'https://oljmrzfgknkqyrwteegi.supabase.co'
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9sam1yemZna25rcXlyd3RlZWdpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc3NzUxMTQsImV4cCI6MjA3MzM1MTExNH0.ej6megeFZA_L2y57_c-GH--1oz8zixWU6Dw_RTa58r0'
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

let currentUser = null
let currentProfile = null

// ---- AUTH ----
async function checkAuth() {
    const { data } = await supabase.auth.getSession()
    if (data.session) {
        currentUser = data.session.user
        await loadProfile()
        showDashboard()
    } else {
        showLogin()
    }
}

async function signup() {
    const email = document.getElementById('signupEmail').value
    const password = document.getElementById('signupPass').value
    const username = document.getElementById('signupUsername').value

    const { data, error } = await supabase.auth.signUp({ email, password })
    if (error) { alert(error.message); return }

    // Create profile with starting balance $10,000
    await supabase.from('profiles').insert([{ id: data.user.id, username, money: 10000, wins:0, losses:0 }])
    alert('Account created! Please log in.')
}

async function login() {
    const email = document.getElementById('loginEmail').value
    const password = document.getElementById('loginPass').value
    const { data, error } = await supabase.auth.signInWithPassword({ email, password })
    if (error) { alert(error.message); return }
    currentUser = data.user
    await loadProfile()
    showDashboard()
}

async function logout() {
    await supabase.auth.signOut()
    location.reload()
}

// ---- PROFILE ----
async function loadProfile() {
    const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', currentUser.id)
        .single()
    if (error) { console.error(error); return }
    currentProfile = data
    document.getElementById('balance').textContent = '$' + currentProfile.money
    document.getElementById('username').textContent = currentProfile.username
}

// ---- BETTING ----
async function placeBet(gameType) {
    const betAmount = parseInt(document.getElementById('betAmount').value)
    if (betAmount > currentProfile.money) { alert('Insufficient balance!'); return }

    const win = Math.random() < 0.45
    const multiplier = win ? Math.random() * 3 + 1 : 0
    const change = win ? Math.floor(betAmount * multiplier) - betAmount : -betAmount

    // Update profile
    await supabase.from('profiles')
        .update({ money: currentProfile.money + change, wins: currentProfile.wins + (win?1:0), losses: currentProfile.losses + (!win?1:0) })
        .eq('id', currentUser.id)
    currentProfile.money += change
    document.getElementById('balance').textContent = '$' + currentProfile.money

    // Update stats table
    await supabase.from('stats').upsert({ key:'total_bets', value: String(parseInt(await getStat('total_bets')) + 1) })
    if (win) {
        const biggest = parseInt(await getStat('biggest_win'))
        if (change + betAmount > biggest) await supabase.from('stats').upsert({ key:'biggest_win', value: String(change + betAmount) })
    }
    const jackpot = parseInt(await getStat('jackpot')) + Math.floor(Math.random()*1000)+100
    await supabase.from('stats').upsert({ key:'jackpot', value: String(jackpot) })

    alert(win ? `üéâ You won $${change + betAmount}!` : `üò¢ You lost $${-change}!`)
    updateStatsDisplay()
}

// ---- STATS ----
async function getStat(key) {
    const { data } = await supabase.from('stats').select('value').eq('key', key).single()
    return data ? parseInt(data.value) : 0
}

async function updateStatsDisplay() {
    document.getElementById('totalBets').textContent = (await getStat('total_bets')).toLocaleString()
    document.getElementById('biggestWin').textContent = '$' + (await getStat('biggest_win')).toLocaleString()
    document.getElementById('jackpot').textContent = '$' + (await getStat('jackpot')).toLocaleString()
}

// ---- GAMES ----
function playGame(gameType) {
    const messages = {
        'slots':'Spin those reels!',
        'blackjack':'Beat the dealer!',
        'roulette':'Place your bets!',
        'poker':'May the best hand win!',
        'dice':'Simple and exciting!',
        'crash':'How high will you go?'
    }
    alert(messages[gameType] || 'Welcome to the game!')
}

// ---- UI ----
function showLogin() {
    document.getElementById('loginSection').style.display='block'
    document.getElementById('dashboard').style.display='none'
}

function showDashboard() {
    document.getElementById('loginSection').style.display='none'
    document.getElementById('dashboard').style.display='block'
    updateStatsDisplay()
}

// ---- INIT ----
window.addEventListener('load', checkAuth)
</script>
<style>
body { font-family:sans-serif; background:#121212; color:#fff; text-align:center; padding:2rem; }
button { padding:0.7rem 1.5rem; margin:0.5rem; cursor:pointer; border-radius:10px; border:none; background:gold; color:#000; font-weight:bold; }
input { padding:0.5rem; margin:0.5rem; border-radius:5px; border:none; width:200px; }
.games-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:1rem; margin-top:1rem; }
.game-card { background:rgba(255,215,0,0.1); padding:1rem; border-radius:10px; cursor:pointer; transition:0.2s; }
.game-card:hover { background:rgba(255,215,0,0.2); }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:1rem; margin-top:1rem; }
.stat-card { background:rgba(255,215,0,0.1); padding:1rem; border-radius:10px; }
</style>
</head>
<body>

<div id="loginSection">
    <h2>Login</h2>
    <input id="loginEmail" type="email" placeholder="Email"><br>
    <input id="loginPass" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <h2>Sign Up</h2>
    <input id="signupUsername" type="text" placeholder="Username"><br>
    <input id="signupEmail" type="email" placeholder="Email"><br>
    <input id="signupPass" type="password" placeholder="Password"><br>
    <button onclick="signup()">Sign Up</button>
</div>

<div id="dashboard" style="display:none">
    <h1>Welcome, <span id="username"></span></h1>
    <h2>Balance: <span id="balance">0</span></h2>
    <input id="betAmount" type="number" value="100"><button onclick="placeBet()">Place Bet</button>
    <button onclick="logout()">Logout</button>

    <h2>Games</h2>
    <div class="games-grid">
        <div class="game-card" onclick="playGame('slots')">üé∞ Slots</div>
        <div class="game-card" onclick="playGame('blackjack')">üÉè Blackjack</div>
        <div class="game-card" onclick="playGame('roulette')">üé≤ Roulette</div>
        <div class="game-card" onclick="playGame('poker')">‚ô†Ô∏è Poker</div>
        <div class="game-card" onclick="playGame('dice')">üéØ Dice</div>
        <div class="game-card" onclick="playGame('crash')">üöÄ Crash</div>
    </div>

    <h2>Live Stats</h2>
    <div class="stats-grid">
        <div class="stat-card">Total Bets: <span id="totalBets">0</span></div>
        <div class="stat-card">Biggest Win: <span id="biggestWin">0</span></div>
        <div class="stat-card">Jackpot: <span id="jackpot">0</span></div>
    </div>
</div>

</body>
</html>
